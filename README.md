# MH Case: Reactive Strength Index (RSI) Analysis

**Version:** 0.1.0  
**Description:** Analysis of marker-based kinematics to compute Reactive Strength Index (RSI) for drop and reactive jumps.  

---

## Table of Contents
1. [Project Overview](#project-overview)  
2. [Installation](#installation)  
3. [Data Structure](#data-structure)  
4. [Usage](#usage)  
5. [Pipeline Description](#pipeline-description)  
6. [Flowcharts](#flowcharts)  
7. [Outputs](#outputs)  
8. [Plotting](#plotting)  
9. [References](#references)  

---

## Project Overview
This project analyzes vertical jump data from OpenSim kinematics to calculate:

- Jump events: Ground Contact (GC), Toe-Off (TO), Landing (LD)  
- Reactive Strength Index (RSI) using two methods:
  - Flight-time method
  - Peak-height method  
- Left/right foot combination and asymmetry  

---

## Installation

### Step 1: Clone the repository

```bash
git clone https://github.com/salilapte/mh-case.git
cd mh-case
```

### Step 2: Set up a virtual environment with uv
```bash
# Create the environment using uv (recommended)
uv venv --python 3.10
# If using conda
conda create -n mh_case python=3.10
# Activate the environment
# macos/linux bash
source .venv/Scripts/activate
# windows Powershell
.venv\Scripts\activate
```

### Step 3: Install dependencies
```bash
# If using pip
conda install pip
pip install -r requirements.txt
# If using uv
uv sync
```
---

## Data Structure

Download the kinematics data amd copy the folder into the root directory of this repository as: mh-case/Data.


The project expects the following folder structure:

```text
Data/
├─ subject1/
│  └─ OpenSimData/
│     └─ Kinematics/
│        └─ trial1.pkl
├─ subject2/
│  └─ ...
```

Each .pkl file should contain:
 - body_kinematics['time']
 - body_kinematics['toes_l_ty'] (left toe Y)
 - body_kinematics['toes_r_ty'] (right toe Y)

---
## Usage

### Terminal

Run the full pipeline:
```bash
python main.py
```

### Python API
```python
from src.rsi_analysis_pipeline import batch_process

# Run batch processing for all subjects/trials
results = batch_process("Data", plot=False)

# Inspect the first few rows
print(results.head())
```
Results are saved automatically to **results/** with timestamped filenames.
Plots for GCT vs Peak Height and RSI vs normative bands are also generated as PNGs.

## Jupyter Notebook: Interactive Analysis

The `src/reactive_jump_analysis.ipynb` notebook allows you to run the RSI pipeline **for a single trial** interactively without generating plots. This is useful for:

- Debugging event detection  
- Inspecting toe trajectories and velocity  
- Testing RSI computation on one trial before batch processing  

### Features:

- Loads a single `.pkl` file containing kinematics  
- Initializes the `JumpEventDetector` with default thresholds  
- Computes per-jump metrics using `RSICalculator`  
- Outputs a DataFrame with:
  - Jump number
  - Ground Contact Time (GCT)
  - Peak height (flight-time and detected)
  - RSI (flight-time and peak-height methods)
  - Asymmetry (NaN for left/right foot)

### How to use:

1. Open the notebook in Jupyter or VS Code Interactive Window.
2. Update the path to your trial `.pkl` file by setting **data_dir**
3. Run the notebook cells sequentially.
4. Inspect the outputs in the last cell; no plots are generated by default.

> Tip: After validating a single trial, you can run the full batch processing pipeline with the `main.py` script to process all subjects and trials.

---
## Pipeline Description

1. Data loading: Loads .pkl files for each subject/trial.
2. Event detection: Detects GC, TO, and LD using Y-position and velocity thresholds.
3. RSI computation: Calculates RSI via flight-time and peak-height methods.
4. Limb combination: Computes median RSI and asymmetry between left/right foot.
5. Output aggregation: Aggregates results across all subjects/trials.
6. Visualization: Generates hieght vs GCT and RSI normative comparison plots.

---
## Flowcharts

Flowcharts for each module are stored in the docs/ folder as Markdown files with Mermaid diagrams.

1. Jump event detection: [view flowchart](docs/event_detector.md)
2. RSI estimation & limb combination: [view flowchart](docs/rsi_analyser.md)
3. Full pipeline: [view flowchart](docs/rsi_analysis_pipeline.md)

---
## Outputs

Exported CSV with columns:

Subject | Trial | Jump | Limb | GCT | PeakHeight_Flight | PeakHeight_Detected | RSI_Flight | RSI_Peak | Asymmetry_% | Subject | Trial |

- Subject / Trial: Metadata
- Jump: Jump number within trial
- Limb: Left, Right, or Combined
- GCT: Ground Contact Time (s)
- PeakHeight_Flight: Jump height via flight-time (m)
- PeakHeight_Detected: Jump height via detected peak (m)
- RSI_Flight / RSI_Peak: Reactive Strength Index
- Asymmetry_Peak%: Difference between left and right foot RSI

---
## Plotting

- GCT vs Peak or Jump Height
- RSI Peak with Normative Bands for performance categories:
 - Poor: < 1.0
 - Average: 1.0–1.5
 - Good: 1.5–2.0
 - Excellent: > 2.0

Plots are saved as PNG in **results/** with timestamp for reproducibility.

---
## References

1. Gymaware, Reactive Strength Index in Sports: https://gymaware.com/reactive-strength-index-rsi-in-sports/
2. Bobbert MF, et al., Mechanics of Drop Jumps: Journal of Biomechanics, 1987.
